# This file was auto-generated by Fern from our API Definition.

import typing

from ..core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ..core.pagination import AsyncPager, SyncPager
from ..core.request_options import RequestOptions
from ..types.chunk_info import ChunkInfo
from ..types.completed_chunk import CompletedChunk
from ..types.create_asset_upload_response import CreateAssetUploadResponse
from ..types.incomplete_upload_summary import IncompleteUploadSummary
from ..types.report_chunk_batch_response import ReportChunkBatchResponse
from ..types.request_additional_presigned_ur_ls_response import RequestAdditionalPresignedUrLsResponse
from .raw_client import AsyncRawMultipartUploadClient, RawMultipartUploadClient
from .types.create_asset_upload_request_type import CreateAssetUploadRequestType

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class MultipartUploadClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawMultipartUploadClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawMultipartUploadClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawMultipartUploadClient
        """
        return self._raw_client

    def list_incomplete_uploads(
        self,
        *,
        page: typing.Optional[int] = None,
        page_limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SyncPager[IncompleteUploadSummary]:
        """
        This method returns a list of all incomplete multipart upload sessions in your account.

        Parameters
        ----------
        page : typing.Optional[int]
            A number that identifies the page to retrieve.

            **Default**: `1`.

        page_limit : typing.Optional[int]
            The number of items to return on each page.

            **Default**: `10`.
            **Max**: `50`.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SyncPager[IncompleteUploadSummary]
            The list of incomplete upload sessions has been successfully retrieved.

        Examples
        --------
        from twelvelabs import TwelveLabs

        client = TwelveLabs(
            api_key="YOUR_API_KEY",
        )
        response = client.multipart_upload.list_incomplete_uploads(
            page=1,
            page_limit=10,
        )
        for item in response:
            yield item
        # alternatively, you can paginate page-by-page
        for page in response.iter_pages():
            yield page
        """
        return self._raw_client.list_incomplete_uploads(
            page=page, page_limit=page_limit, request_options=request_options
        )

    def create(
        self,
        *,
        filename: str,
        type: CreateAssetUploadRequestType,
        total_size: int,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CreateAssetUploadResponse:
        """
        This method creates a multipart upload session.

        **Supported content**: Video and audio

        **File size**: 4GB maximum.

        **Additional requirements** depend on your workflow:
        - **Search**: [Marengo requirements](/v1.3/docs/concepts/models/marengo#video-file-requirements)
        - **Video analysis**: [Pegasus requirements](/v1.3/docs/concepts/models/pegasus#input-requirements)
        - **Create embeddings**: [Marengo requirements](/v1.3/docs/concepts/models/marengo#input-requirements)

        Parameters
        ----------
        filename : str
            The original file name of the asset.

        type : CreateAssetUploadRequestType
            The type of asset you want to upload.

        total_size : int
            The total size of the file in bytes. The platform uses this value to:
            - Calculate the optimal chunk size.
            - Determine the total number of chunks required
            - Generate the initial set of presigned URLs

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAssetUploadResponse
            The multipart upload session has been successfully created.

        Examples
        --------
        from twelvelabs import TwelveLabs

        client = TwelveLabs(
            api_key="YOUR_API_KEY",
        )
        client.multipart_upload.create(
            filename="my-video.mp4",
            type="video",
            total_size=104857600,
        )
        """
        _response = self._raw_client.create(
            filename=filename, type=type, total_size=total_size, request_options=request_options
        )
        return _response.data

    def get_status(
        self,
        upload_id: str,
        *,
        page: typing.Optional[int] = None,
        page_limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SyncPager[ChunkInfo]:
        """
        This method provides information about an upload session, including its current status, chunk-level progress, and completion state.

        Use this method to:
        - Verify upload completion (`status` = `completed`)
        - Identify any failed chunks that require a retry
        - Monitor the upload progress by comparing `uploaded_size` with `total_size`
        - Determine if the session has expired
        - Retrieve the status information for each chunk

        You must call this method after reporting chunk completion to confirm the upload has transitioned to the `completed` status before using the asset.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        page : typing.Optional[int]
            A number that identifies the page to retrieve.

            **Default**: `1`.

        page_limit : typing.Optional[int]
            The number of items to return on each page.

            **Default**: `10`.
            **Max**: `50`.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SyncPager[ChunkInfo]
            The status of your upload session has been successfully retrieved.

        Examples
        --------
        from twelvelabs import TwelveLabs

        client = TwelveLabs(
            api_key="YOUR_API_KEY",
        )
        response = client.multipart_upload.get_status(
            upload_id="507f1f77bcf86cd799439011",
            page=1,
            page_limit=10,
        )
        for item in response:
            yield item
        # alternatively, you can paginate page-by-page
        for page in response.iter_pages():
            yield page
        """
        return self._raw_client.get_status(upload_id, page=page, page_limit=page_limit, request_options=request_options)

    def report_chunk_batch(
        self,
        upload_id: str,
        *,
        completed_chunks: typing.Sequence[CompletedChunk],
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ReportChunkBatchResponse:
        """
        This method reports successfully uploaded chunks to the platform. The platform finalizes the upload after you report all chunks.


        For optimal performance, report chunks in batches and in any order.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        completed_chunks : typing.Sequence[CompletedChunk]
            The list of chunks successfully uploaded that you're reporting to the platform. Report only after receiving an ETag.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ReportChunkBatchResponse
            The completion of this batch has been successfully reported.

        Examples
        --------
        from twelvelabs import CompletedChunk, TwelveLabs

        client = TwelveLabs(
            api_key="YOUR_API_KEY",
        )
        client.multipart_upload.report_chunk_batch(
            upload_id="507f1f77bcf86cd799439011",
            completed_chunks=[
                CompletedChunk(
                    chunk_index=1,
                    proof="d41d8cd98f00b204e9800998ecf8427e",
                    proof_type="etag",
                    chunk_size=5242880,
                )
            ],
        )
        """
        _response = self._raw_client.report_chunk_batch(
            upload_id, completed_chunks=completed_chunks, request_options=request_options
        )
        return _response.data

    def get_additional_presigned_urls(
        self, upload_id: str, *, start: int, count: int, request_options: typing.Optional[RequestOptions] = None
    ) -> RequestAdditionalPresignedUrLsResponse:
        """
        This method generates new presigned URLs for specific chunks that require uploading. Use this endpoint in the following situations:
        - Your initial URLs have expired (URLs expire after one hour).
        - The initial set of presigned URLs does not include URLs for all chunks.
        - You need to retry failed chunk uploads with new URLs.
        To specify which chunks need URLs, use the `start` and `count` parameters. For example, to generate URLs for chunks 21 to 30, use `start=21` and `count=10`.
        The response will provide new URLs, each with a fresh expiration time of one hour.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        start : int
            The index of the first chunk number to generate URLs for. Chunks are numbered from 1.

        count : int
            The number of presigned URLs to generate starting from the index. You can request a maximum of 50 URLs in a single API call.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RequestAdditionalPresignedUrLsResponse
            Additional presigned URLs have been successfully generated.

        Examples
        --------
        from twelvelabs import TwelveLabs

        client = TwelveLabs(
            api_key="YOUR_API_KEY",
        )
        client.multipart_upload.get_additional_presigned_urls(
            upload_id="507f1f77bcf86cd799439011",
            start=1,
            count=10,
        )
        """
        _response = self._raw_client.get_additional_presigned_urls(
            upload_id, start=start, count=count, request_options=request_options
        )
        return _response.data


class AsyncMultipartUploadClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawMultipartUploadClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawMultipartUploadClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawMultipartUploadClient
        """
        return self._raw_client

    async def list_incomplete_uploads(
        self,
        *,
        page: typing.Optional[int] = None,
        page_limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> AsyncPager[IncompleteUploadSummary]:
        """
        This method returns a list of all incomplete multipart upload sessions in your account.

        Parameters
        ----------
        page : typing.Optional[int]
            A number that identifies the page to retrieve.

            **Default**: `1`.

        page_limit : typing.Optional[int]
            The number of items to return on each page.

            **Default**: `10`.
            **Max**: `50`.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AsyncPager[IncompleteUploadSummary]
            The list of incomplete upload sessions has been successfully retrieved.

        Examples
        --------
        import asyncio

        from twelvelabs import AsyncTwelveLabs

        client = AsyncTwelveLabs(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            response = await client.multipart_upload.list_incomplete_uploads(
                page=1,
                page_limit=10,
            )
            async for item in response:
                yield item

            # alternatively, you can paginate page-by-page
            async for page in response.iter_pages():
                yield page


        asyncio.run(main())
        """
        return await self._raw_client.list_incomplete_uploads(
            page=page, page_limit=page_limit, request_options=request_options
        )

    async def create(
        self,
        *,
        filename: str,
        type: CreateAssetUploadRequestType,
        total_size: int,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CreateAssetUploadResponse:
        """
        This method creates a multipart upload session.

        **Supported content**: Video and audio

        **File size**: 4GB maximum.

        **Additional requirements** depend on your workflow:
        - **Search**: [Marengo requirements](/v1.3/docs/concepts/models/marengo#video-file-requirements)
        - **Video analysis**: [Pegasus requirements](/v1.3/docs/concepts/models/pegasus#input-requirements)
        - **Create embeddings**: [Marengo requirements](/v1.3/docs/concepts/models/marengo#input-requirements)

        Parameters
        ----------
        filename : str
            The original file name of the asset.

        type : CreateAssetUploadRequestType
            The type of asset you want to upload.

        total_size : int
            The total size of the file in bytes. The platform uses this value to:
            - Calculate the optimal chunk size.
            - Determine the total number of chunks required
            - Generate the initial set of presigned URLs

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAssetUploadResponse
            The multipart upload session has been successfully created.

        Examples
        --------
        import asyncio

        from twelvelabs import AsyncTwelveLabs

        client = AsyncTwelveLabs(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.multipart_upload.create(
                filename="my-video.mp4",
                type="video",
                total_size=104857600,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create(
            filename=filename, type=type, total_size=total_size, request_options=request_options
        )
        return _response.data

    async def get_status(
        self,
        upload_id: str,
        *,
        page: typing.Optional[int] = None,
        page_limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> AsyncPager[ChunkInfo]:
        """
        This method provides information about an upload session, including its current status, chunk-level progress, and completion state.

        Use this method to:
        - Verify upload completion (`status` = `completed`)
        - Identify any failed chunks that require a retry
        - Monitor the upload progress by comparing `uploaded_size` with `total_size`
        - Determine if the session has expired
        - Retrieve the status information for each chunk

        You must call this method after reporting chunk completion to confirm the upload has transitioned to the `completed` status before using the asset.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        page : typing.Optional[int]
            A number that identifies the page to retrieve.

            **Default**: `1`.

        page_limit : typing.Optional[int]
            The number of items to return on each page.

            **Default**: `10`.
            **Max**: `50`.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AsyncPager[ChunkInfo]
            The status of your upload session has been successfully retrieved.

        Examples
        --------
        import asyncio

        from twelvelabs import AsyncTwelveLabs

        client = AsyncTwelveLabs(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            response = await client.multipart_upload.get_status(
                upload_id="507f1f77bcf86cd799439011",
                page=1,
                page_limit=10,
            )
            async for item in response:
                yield item

            # alternatively, you can paginate page-by-page
            async for page in response.iter_pages():
                yield page


        asyncio.run(main())
        """
        return await self._raw_client.get_status(
            upload_id, page=page, page_limit=page_limit, request_options=request_options
        )

    async def report_chunk_batch(
        self,
        upload_id: str,
        *,
        completed_chunks: typing.Sequence[CompletedChunk],
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ReportChunkBatchResponse:
        """
        This method reports successfully uploaded chunks to the platform. The platform finalizes the upload after you report all chunks.


        For optimal performance, report chunks in batches and in any order.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        completed_chunks : typing.Sequence[CompletedChunk]
            The list of chunks successfully uploaded that you're reporting to the platform. Report only after receiving an ETag.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ReportChunkBatchResponse
            The completion of this batch has been successfully reported.

        Examples
        --------
        import asyncio

        from twelvelabs import AsyncTwelveLabs, CompletedChunk

        client = AsyncTwelveLabs(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.multipart_upload.report_chunk_batch(
                upload_id="507f1f77bcf86cd799439011",
                completed_chunks=[
                    CompletedChunk(
                        chunk_index=1,
                        proof="d41d8cd98f00b204e9800998ecf8427e",
                        proof_type="etag",
                        chunk_size=5242880,
                    )
                ],
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.report_chunk_batch(
            upload_id, completed_chunks=completed_chunks, request_options=request_options
        )
        return _response.data

    async def get_additional_presigned_urls(
        self, upload_id: str, *, start: int, count: int, request_options: typing.Optional[RequestOptions] = None
    ) -> RequestAdditionalPresignedUrLsResponse:
        """
        This method generates new presigned URLs for specific chunks that require uploading. Use this endpoint in the following situations:
        - Your initial URLs have expired (URLs expire after one hour).
        - The initial set of presigned URLs does not include URLs for all chunks.
        - You need to retry failed chunk uploads with new URLs.
        To specify which chunks need URLs, use the `start` and `count` parameters. For example, to generate URLs for chunks 21 to 30, use `start=21` and `count=10`.
        The response will provide new URLs, each with a fresh expiration time of one hour.

        Parameters
        ----------
        upload_id : str
            The unique identifier of the upload session.

        start : int
            The index of the first chunk number to generate URLs for. Chunks are numbered from 1.

        count : int
            The number of presigned URLs to generate starting from the index. You can request a maximum of 50 URLs in a single API call.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RequestAdditionalPresignedUrLsResponse
            Additional presigned URLs have been successfully generated.

        Examples
        --------
        import asyncio

        from twelvelabs import AsyncTwelveLabs

        client = AsyncTwelveLabs(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.multipart_upload.get_additional_presigned_urls(
                upload_id="507f1f77bcf86cd799439011",
                start=1,
                count=10,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_additional_presigned_urls(
            upload_id, start=start, count=count, request_options=request_options
        )
        return _response.data
